/**
 * A plugin to identify and validate heading tags (<h1>, <h2>, etc.)
 */

let $ = require("jquery");
let Plugin = require("../base");
let annotate = require("../shared/annotate")("headings");

let outlineItemTemplate = require("./outline-item.handlebars");
require("./style.less");

const ERRORS = {
    MULTIPLE_TITLES: {
        title: "Multiple &lt;title&gt; tags provided"
    }
};

class TitlePlugin extends Plugin {
    getTitle() {
        return "Title";
    }

    getDescription() {
        return "Title Violations";
    }

    /**
     * Computes an outline of the page and reports any violations.
     */
    outline($titles) {
	let error;
        if ($titles.length > 1) {
                error = ERRORS.MULTIPLE_TITLES;    // eslint-disable-line new-cap
	}

	if (error) {
	    // Register an error to the info panel
	    let infoPanelError = this.error(
					    error.title, $(error.description), $titles[0]);
	}

        return $titles;
    }

    run() {
        let $titles = $("title");
        // `this.outline` has the side-effect of also reporting violations
        let $items = this.outline($titles);

        if ($items.length) {
            let $outline = (
                <div className="tota11y-heading-outline">
                    {$items}
                </div>
            );

            this.summary($outline);
        }
    }


    get_results(context_data) {
	let results = this.run();
	return results;
    }


    cleanup() {
        annotate.removeAll();
    }
}

module.exports = TitlePlugin;
